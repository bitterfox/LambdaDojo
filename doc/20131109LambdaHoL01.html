<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="">
<meta name="author" content="">
<link rel="shortcut icon" href="assets/ico/favicon.png">
<title>Project Lmbda Hands on, 2013.11.09</title>

<!-- Bootstrap core CSS -->
<link href="dist/css/bootstrap.css" rel="stylesheet">

<!-- Custom styles for this template -->
<link href="starter.css" rel="stylesheet">

<script src="https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js"></script>
</head>

<body>
<div class="navbar navbar-inverse navbar-fixed-top">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse"> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button>
      <a class="navbar-brand" href="#">Project Lmbda Hands on, 2013.11.09</a> </div>
  </div>
</div>
<div class="container">
  <div class="main">
    <h1>Lambda 道場 問題編</h1>
    <div class="row">
      <div class="col-md-3">
        <div class="sidebar">
          <p>Lambda 道場 問題編</p>
          <ul>
            <li>1. はじめに</li>
            <li><a href="#sec2">2. Lambda 式</a></li>
            <li><a href="#sec3">3. for 文の変換 (Iterable)</a></li>
            <li><a href="#sec4">4. for 文の変換 (Stream)</a></li>
          </ul>
        </div>
      </div>
      <div class="col-md-9">
        <h2>1. はじめに</h2>
        <p>Java SE 8 で Project Lambda が導入されます。Project Lambda の Lambda 式や Stream API を使用することで、関数型言語のアイデアを導入することができ、内部イテレータによって処理を行うことが可能になります。</p>
        <p>今までの外部イテレータを使用した処理から、内部イテレータでの処理への移行により、Java のプログラミングスタイルが大きく変化しようとしています。</p>
        <p>すでに、Java SE 8 の Developer Preview も公開されているので、今すぐにでも Project Lambda を試すことができます。</p>
        <p>そこで、JJUG CCC のハンズオンでは Project Lambda の Lambda 式や Stream を書いていただきます。習うより慣れろで、繰り返し書くことにより内部イテレータの書き方も身についていくはずです。</p>
        <p>本ハンズオンでは、プログラムの断片を提示していきます。それを Lambda 式や Stream で書き換えていってください。PC はなくても大丈夫。鉛筆で直接書き換えていってください。</p>
        <p>もし、余裕があるのであれば、家に帰ってから、ぜひ PC で実行し直してみてください。使用した問題、解答は GitHub の LambdaDojo プロジェクトに置いておきます。<a name="sec2" id="sec" ></a></p>
        <p>&nbsp;</p>
        <p>LambdaDojo <a href="https://github.com/skrb/LambdaDojo">https://github.com/skrb/LambdaDojo</a></p>
        <p>&nbsp;</p>
        <h2>2. Lambda 式</h2>
        <p>Project Lambda で最も重要なのは内部イテレータを実現する Stream API です。しかし、Lambda 式が書けないと、Stream API も冗長な匿名クラスで書かざるをえません。やはり、Lambda 式で記述することによって、Stream API も簡潔になります。</p>
        <p>Lambda 式は関数型インタフェースを実装した匿名クラスの簡易的な記述法です。関数型インタフェースは実装すべきメソッドが単一の関数で @FunctionalInterface でインタフェースが修飾されています。</p>
        <p>Lambda 式は (引数) -&gt; { 処理 } の形式で表します。引数は関数型インタフェースの実装すべきメソッドの引数を表し、処理はそのメソッドの実体を表しています。</p>
        <p>そこで、まず匿名クラスを Lambda 式を書き換えてみてましょう。</p>
        <p>&nbsp;</p>
        <h4>2-1. Lambda 式で書き換えてみましょう</h4>
        <div>
        <pre class="prettyprint">        Comparator&lt;Integer&gt; comparator1 = new Comparator&lt;Integer&gt;() {
            @Override
            public int compare(Integer x, Integer y) {
                return x - y;
            }
        };</pre></div>
        <p>&nbsp;</p>
        <h4>2-2. Lambda 式で書き換えてみましょう</h4>
        <div>
        <pre class="prettyprint">        Callable&lt;Date&gt; callable1 = new Callable&lt;Date&gt;() {
            @Override
            public Date call() throws Exception {
                return new Date();
            }
        };</pre></div>
        <p>&nbsp;</p>
        <h4>2-3. Lambda 式で書き換えてみましょう</h4>
        <div>
        <pre class="prettyprint">        Runnable runnable1 = new Runnable() {
            @Override
            public void run() {
                doSomething();
            }
        };</pre></div>
        <p>&nbsp;</p>
        <h4>2-4. Lambda 式で書き換えてみましょう</h4>
        <div>
          <pre class="prettyprint">    @FunctionalInterface
    public interface Doubler&lt;T extends Number&gt; {
        T doDouble(T x);
    }
 
    ...
 
        Doubler<Double> doubler = new Doubler<Double>() {
            @Override
            public Double doDouble(Double x) {
                return 2.0 * x;
            }
        };</pre>
        </div>
        <p>&nbsp;</p>
        <h4>2-5. Lambda 式で書き換えてみましょう</h4>
        <p>次のプログラムは Swing のプログラムです。ボタンをクリックするとカウンタが増加するというだけの単純なプログラムですが、ここで使われている匿名クラスを Lambda 式で書き換えてみましょう。</p>
        <div>
          <pre class="prettyprint">public class LambdaForSwing {
    private int count;
    
    public LambdaForSwing() {
        JFrame frame = new JFrame("Swing Lambda");
        frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
        
        JButton button = new JButton("Count");
        frame.add(button, BorderLayout.NORTH);
        
        final JLabel counter = new JLabel(String.valueOf(count));
        frame.add(counter, BorderLayout.CENTER);
        
        button.addActionListener(new ActionListener() {
            @Override
            public void actionPerformed(ActionEvent e) {
                count++;
                counter.setText(String.valueOf(count));
            }
        });
        
        frame.pack();
        frame.setVisible(true);
    }
    
    public static void main(String... args) {
        SwingUtilities.invokeLater(new Runnable() {
            @Override
            public void run() {
                new SwingLambda();
            }
        });

    }
}</pre><a name="sec3" id="sec3" ></a>
        </div>
        <p>&nbsp;</p>
        <h3>3. for 文の変換 (Iterable)</h3>
        <p>Lambda 文を書くことに慣れたら、外部イテレータを内部イテレータで書き直してみましょう。</p>
        <p>最も単純な方法は、Iterable インタフェースに追加された forEach メソッドです。forEach メソッドを使用することで、拡張 for 文を内部イテレータに変換することが可能です。</p>
        <p>&nbsp;</p>
        <h4>3-1. forEach メソッドで書き換えてみましょう</h4>
        <div>
          <pre class="prettyprint">        List&lt;String&gt; strings = Arrays.asList("a", "b", "c", "d", "e");
        
        StringBuilder builder = new StringBuilder();
        for (String s: strings) {
            builder.append(s);
        }
        System.out.println(builder.toString());</pre>
        </div>
        <p>&nbsp;</p>
        <h4>3-2. forEach メソッドで書き換えてみましょう</h4>
        <div>
          <pre class="prettyprint">        List&lt;Integer&gt; numbers = Arrays.asList(10, 5, 2, 20, 12, 15);
 
        int sum = 0;
        for (Integer number: numbers) {
            sum += number;
        }
        System.out.println(sum);</pre>
        </div>
        <p>&nbsp;</p>
        <h4>3-3. forEach メソッドで書き換えてみましょう</h4>
        <p>拡張 for 文でない、単純な for 文も forEach メソッドで書き換えることができます。ただし、この場合ループインデックスを作成しなければなりません。この場合、Iterable の forEach メソッドではなく、Stream の forEach メソッドが使われます。</p>
        <p>ここでは単純なループインデックスを使用して、書き換えを行ってみましょう。</p>
        <div>
          <pre class="prettyprint">        for (int i = 0; i &lt; 10; i++) {
            System.out.print(i);
        }
        System.out.println();</pre><a name="sec4" id="sec4" ></a>
        </div>
        <p>&nbsp;</p>
        <h3>4. for 文の変換 (Stream)</h3>
        <p>最後は、Stream です。Stream にはオブジェクトを対象とした Stream インタフェース、プリミティブが対象の IntStream インタフェース、LongStream インタフェース、DoubleStream インタフェースの 4 種類があります。</p>
        <p>基本的なメソッドは同じですが、sum メソッド、max メソッドなどプリミティブが対象の Stream にしかないメソッドもあります。</p>
        <p>はじめから様々な処理を行っている for 文を変換するのは難しので、簡単な例から徐々に慣れていきましょう。</p>
        <p>&nbsp;</p>
        <h4>4-1. Stream で書き換えてみましょう</h4>
        <div>
          <pre class="prettyprint">        List&lt;Integer&gt; numbers = Arrays.asList(0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10);
        for (Integer x: numbers) {
            if (x % 2 == 0) {
                System.out.print(x);
            }
        }
        System.out.println();</pre>
        </div>
        <p>&nbsp;</p>
        <h4>4-2. Stream で書き換えてみましょう</h4>
        <div>
          <pre class="prettyprint">        Random random = new Random();
        List<Double> numbers = new ArrayList<>();
        for (int i = 0; i &lt; 100; i++) {
            numbers.add(random.nextDouble());
        }
        
        double ave = 0.0;
        for (Double x: numbers) {
            ave += x;
        }
        ave /= numbers.size();
        
        double div = 0.0;
        for (Double x: numbers) {
            div += (x - ave) * (x -ave);                    
        }
        div /= numbers.size();</pre>
        </div>
        <p>&nbsp;</p>
        <p>&nbsp;</p>
        <h4>4-3. Stream で書き換えてみましょう</h4>
        <p>次に行うのはファイルを読み込んで単語数を数えるプログラムの断片です。これも Stream で書き換えてみましょう。</p>
        <p>ヒント: BufferReader クラスに Java SE 8 で追加されたメソッドがありますよ。</p>
        <div>
          <pre class="prettyprint">        try (BufferedReader reader = new BufferedReader(new FileReader(filename))) {
            int wordCount = 0;
            
            for (;;) {
                String line = reader.readLine();
                if (line == null) {
                    break;
                }
                
                String[] words = line.split(" ");
                wordCount += words.length;
            }
            System.out.println(wordCount);
        } catch (IOException ex) {
            // 例外処理
        } </pre>
        </div>
        <p>いかがでしたでしょうか。</p>
        <p>ちなみに、個々の問題は正解が 1 つとは限りません。いろいろな書き方があり、それに応じて使用するメソッドも変化します。いろいろな書き方をできるようにしておくと、応用範囲がひろがると思います。</p>
        <p>&nbsp;</p>
      </div>
    </div>
  </div>
</div>
<!-- /.container --> 

<!-- Bootstrap core JavaScript
    ================================================== --> 
<!-- Placed at the end of the document so the pages load faster --> 
<script src="assets/js/jquery.js"></script> 
<script src="dist/js/bootstrap.min.js"></script>
</body>
</html>
